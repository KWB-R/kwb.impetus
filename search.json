[{"path":"https://kwb-r.github.io/kwb.impetus/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2022 Kompetenzzentrum Wasser Berlin gGmbH (KWB) Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":[]},{"path":"https://kwb-r.github.io/kwb.impetus/articles/dwd.html","id":"precipitation","dir":"Articles","previous_headings":"Create Plots","what":"Precipitation","title":"Deutscher Wetterdienst (DWD)","text":"","code":"para_name <- \"precipitation\"  precipitation <- kwb.impetus::dwd_berlin_monthly %>%    dplyr::filter(.data$parameter == para_name) %>%     dplyr::mutate(Jahr = as.integer(.data$year),                  Dekade = kwb.impetus::floor_decade(.data$year),                 Dekade_Label = sprintf(\"%d - %d\",                                         .data$Dekade,                                         .data$Dekade + 9),                 Monat = as.factor(.data$month),                 Label = sprintf(\"DWD, monthly %s\", .data$parameter))  precipitation_agg <- precipitation %>%    dplyr::group_by(.data$Dekade,                   .data$Dekade_Label,                    .data$Monat,                    .data$Label) %>%    dplyr::summarise(q05 = as.numeric(quantile(.data$mean, probs = 0.05)),                    q95 = as.numeric(quantile(.data$mean, probs = 0.95)),                    mean = mean(.data$mean)                    )    n_decades <- length(unique(precipitation_agg$Dekade_Label))  decade_colors <- c('darkblue', 'blue', 'darkgreen', 'lightgreen', 'orange', 'red') n_colors <- length(decade_colors)  n_colors_to_fill <- n_decades - n_colors  decades <- tibble::tibble(names = unique(precipitation_agg$Dekade_Label)[order(unique(precipitation_agg$Dekade_Label))],                           values = c(rep(\"black\", n_colors_to_fill),                                       'darkblue', 'blue', 'darkgreen', 'lightgreen', 'orange', 'red'))  precipitation_decade_annual <- precipitation_agg %>%     dplyr::group_by(.data$Dekade_Label) %>%    dplyr::summarise(annual_mean = sum(.data$mean))                    kwb.utils::preparePdf(\"dwd_monthly_precipitation.pdf\",                       landscape = TRUE,                       width.cm = 50,                        height.cm = 21) #> [1] \"dwd_monthly_precipitation.pdf\"    # p1 <- precipitation_agg %>%   #   dplyr::left_join(precipitation_decade_annual) %>%  #   dplyr::mutate(Dekade_Label = sprintf(\"%s\\n%3.1f mm/Jahr)\", #                                        .data$Dekade_Label, #                                        round(.data$annual_mean, 1)))   p1 <- precipitation_agg   p2 <- precipitation %>%    dplyr::filter(.data$Jahr == max(.data$Jahr)) %>%    dplyr::group_by(.data$Jahr,                   .data$Monat) %>%    dplyr::summarise(q05 = quantile(.data$mean, probs = 0.05),                    q95 = quantile(.data$mean, probs = 0.95),                    mean = mean(.data$mean))    n_decades <- length(unique(p1$Dekade_Label))  gg <- p1 %>%    ggplot2::ggplot(mapping = ggplot2::aes(x = as.integer(.data$Monat),                                           y = .data$mean,                                          col = as.factor(.data$Dekade_Label))) +    #ggplot2::geom_point(alpha = 0.5) +    ggplot2::geom_ribbon(ggplot2::aes_string(ymin = \"q05\",                                             ymax = \"q95\",                                             fill = \"Dekade_Label\"),                         alpha = 0.1) +    kwb.impetus::scale_fill_decades(decades) +   kwb.impetus::scale_color_decades(decades) +   ggplot2::geom_point() +   ggplot2::geom_point(ggplot2::aes(x = as.integer(.data$Monat),                                    y = .data$mean),                        data = p2,                       col = \"darkgrey\",                       alpha = 0.5,                        inherit.aes = FALSE,                       show.legend = FALSE) +   ggplot2::scale_x_continuous(breaks = 1:12, labels = 1:12, minor_breaks = NULL) +   #ggplot2::geom_boxplot() +   ggplot2::facet_wrap( ~ .data$Dekade_Label,                        nrow = 1,                         ncol = n_decades) +   ggplot2::theme_bw() +    ggplot2::theme(legend.position=\"bottom\") +   ggplot2::labs(y = \"Monatsmittel Niederschlag (mm/Monat)\",                  x = \"Monatsnummer\",                  col = \"Mittelwert\",                  fill = \"5%/95% Konf.-intervall\",                 title = unique(p1$Label)) print(gg)  dev.off() #> agg_png  #>       2"},{"path":"https://kwb-r.github.io/kwb.impetus/articles/dwd.html","id":"potential-evaporation","dir":"Articles","previous_headings":"Create Plots","what":"Potential Evaporation","title":"Deutscher Wetterdienst (DWD)","text":"","code":"para_name <- \"potential evaporation\"  potential_evaporation <- kwb.impetus::dwd_berlin_monthly %>%    dplyr::filter(.data$parameter == para_name) %>%     dplyr::mutate(Jahr = as.integer(.data$year),                  Dekade = kwb.impetus::floor_decade(.data$year),                 Dekade_Label = sprintf(\"%d - %d\",                                         .data$Dekade,                                         .data$Dekade + 9),                 Monat = as.factor(.data$month),                 Label = sprintf(\"DWD, monthly %s\", .data$parameter))  potential_evaporation_agg <- potential_evaporation %>%    dplyr::group_by(.data$Dekade,                   .data$Dekade_Label,                    .data$Monat,                    .data$Label) %>%    dplyr::summarise(q05 = as.numeric(quantile(.data$mean, probs = 0.05)),                    q95 = as.numeric(quantile(.data$mean, probs = 0.95)),                    mean = mean(.data$mean)                    )    n_decades <- length(unique(potential_evaporation_agg$Dekade_Label))  decade_colors <- c('darkgreen', 'lightgreen', 'orange', 'red') n_colors <- length(decade_colors)  decades <- tibble::tibble(names = unique(potential_evaporation_agg$Dekade_Label)[order(unique(potential_evaporation_agg$Dekade_Label))],                           values = decade_colors)  potential_evaporation_decade_annual <- potential_evaporation_agg %>%     dplyr::group_by(.data$Dekade_Label) %>%    dplyr::summarise(annual_mean = sum(.data$mean))                    kwb.utils::preparePdf(\"dwd_monthly_potential-evaporation.pdf\",                       landscape = TRUE,                       width.cm = 35,                        height.cm = 21) #> [1] \"dwd_monthly_potential-evaporation.pdf\"    # p1 <- precipitation_agg %>%   #   dplyr::left_join(precipitation_decade_annual) %>%  #   dplyr::mutate(Dekade_Label = sprintf(\"%s\\n%3.1f mm/Jahr)\", #                                        .data$Dekade_Label, #                                        round(.data$annual_mean, 1)))   p1 <- potential_evaporation_agg   p2 <- potential_evaporation %>%    dplyr::filter(.data$Jahr == max(.data$Jahr)) %>%    dplyr::group_by(.data$Jahr,                   .data$Monat) %>%    dplyr::summarise(q05 = quantile(.data$mean, probs = 0.05),                    q95 = quantile(.data$mean, probs = 0.95),                    mean = mean(.data$mean))    n_decades <- length(unique(p1$Dekade_Label))  gg <- p1 %>%    ggplot2::ggplot(mapping = ggplot2::aes(x = as.integer(.data$Monat),                                           y = .data$mean,                                          col = as.factor(.data$Dekade_Label))) +    #ggplot2::geom_point(alpha = 0.5) +    ggplot2::geom_ribbon(ggplot2::aes_string(ymin = \"q05\",                                             ymax = \"q95\",                                             fill = \"Dekade_Label\"),                         alpha = 0.1) +    kwb.impetus::scale_fill_decades(decades) +   kwb.impetus::scale_color_decades(decades) +   ggplot2::geom_point() +   ggplot2::geom_point(ggplot2::aes(x = as.integer(.data$Monat),                                    y = .data$mean),                        data = p2,                       col = \"darkgrey\",                       alpha = 0.5,                        inherit.aes = FALSE,                       show.legend = FALSE) +   ggplot2::scale_x_continuous(breaks = 1:12, labels = 1:12, minor_breaks = NULL) +   #ggplot2::geom_boxplot() +   ggplot2::facet_wrap( ~ .data$Dekade_Label,                        nrow = 1,                         ncol = n_decades) +   ggplot2::theme_bw() +    ggplot2::theme(legend.position=\"bottom\") +   ggplot2::labs(y = \"Monatsmittel potentielle Verdunstung (mm/Monat)\",                  x = \"Monatsnummer\",                  col = \"Mittelwert\",                  fill = \"5%/95% Konf.-intervall\",                 title = unique(p1$Label)) print(gg)  dev.off() #> agg_png  #>       2"},{"path":"https://kwb-r.github.io/kwb.impetus/articles/dwd.html","id":"download","dir":"Articles","previous_headings":"","what":"Download","title":"Deutscher Wetterdienst (DWD)","text":"plots created code exported pdf files, available download : dwd_monthly_potential-evaporation.pdf dwd_monthly_precipitation.pdf","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/articles/wasserportal.html","id":"install-r-package","dir":"Articles","previous_headings":"","what":"Install R Package","title":"Wasserportal","text":"","code":"# Enable repository from kwb-r options(repos = c(   kwbr = 'https://kwb-r.r-universe.dev',   CRAN = 'https://cloud.r-project.org' ))  # Download and install kwb.impetus in R install.packages('kwb.impetus')"},{"path":"https://kwb-r.github.io/kwb.impetus/articles/wasserportal.html","id":"define-helper-functions","dir":"Articles","previous_headings":"","what":"Define Helper Functions","title":"Wasserportal","text":"","code":"library(kwb.impetus)  get_master <- function(stations_df) {      if (\"Betreiber\" %in% names(stations_df)) {     stations_df <- stations_df %>%        dplyr::filter(.data$Betreiber == \"Land Berlin\")    }      urls <- stations_df %>% dplyr::pull(.data$stammdaten_link)      wasserportal::get_wasserportal_masters_data(master_urls = urls) %>%      dplyr::rename(Messstellennummer = .data$Nummer) %>%      dplyr::mutate(Messstellennummer = as.double(.data$Messstellennummer)) }  get_data_name <- function(para_name) {   prefix <- ifelse(startsWith(para_name, \"surface\"), \"daily_\", \"\")   paste0(prefix, para_name) }  get_master_name <- function(para_name) {   paste0(\"stations_\", para_name) }  numeric_quantile <- function(x, prob) {   as.numeric(quantile(x, probs = prob)) }  decade_label <- function(decade) {   sprintf(\"%d - %d\", decade, decade + 9L) }  label_river_km <- function(data) {   sprintf(     \"%s (%s, id: %s, fluss-km: %2.2f)\",      data$Name,     data$Gewaesser,      data$Messstellennummer,      as.numeric(data$Flusskilometer)   ) }  set_date_year_decade_month <- function(data) {   data %>%      dplyr::mutate(       Datum = as.Date(.data$Datum),       Jahr = as.integer(format(.data$Datum, \"%Y\")),        Dekade = kwb.impetus::floor_decade(.data$Jahr),       Dekade_Label = decade_label(.data$Dekade),       Monat = as.factor(format(.data$Datum, \"%m\"))     ) }  decades_tibble <- function(decade_labels) {   tibble::tibble(     names = sort(unique(decade_labels)),     values = c('darkblue', 'blue', 'darkgreen', 'lightgreen', 'orange', 'red')   ) }  decade_ribbons <- function(alpha = 0.1) {   ggplot2::geom_ribbon(     ggplot2::aes_string(       ymin = \"q05\",        ymax = \"q95\",        fill = \"Dekade_Label\"     ),      alpha = alpha   ) }  group_by_site_decade_month_label <- function(data) {   data %>%     dplyr::group_by(       .data$Messstellennummer,        .data$Dekade,       .data$Dekade_Label,        .data$Monat,        .data$Label     ) }  group_by_site_year_month_label <- function(data) {   data %>%     dplyr::group_by(       .data$Messstellennummer,        .data$Jahr,       .data$Monat,        .data$Label     ) }  summarise_daily_mean_levels <- function(data) {   data %>%     dplyr::summarise(       Monatsmittelwert_Pegelstand_mNN = mean(.data$Tagesmittelwert_Pegelstand_mNN),       q05 = numeric_quantile(.data$Tagesmittelwert_Pegelstand_mNN, 0.05),       q95 = numeric_quantile(.data$Tagesmittelwert_Pegelstand_mNN, 0.95)     ) }  summarise_daily_mean_values <- function(data) {   data %>%     dplyr::summarise(       Monatsmittelwert = mean(.data$Tagesmittelwert),       q05 = numeric_quantile(.data$Tagesmittelwert, 0.05),       q95 = numeric_quantile(.data$Tagesmittelwert, 0.95),     )  }  summarise_measurements <- function(data) {   data %>%     dplyr::summarise(       Monatsmittelwert = mean(.data$Messwert),       q05 = numeric_quantile(.data$Messwert, 0.05),       q95 = numeric_quantile(.data$Messwert, 0.95),     )  }"},{"path":"https://kwb-r.github.io/kwb.impetus/articles/wasserportal.html","id":"surface-water","dir":"Articles","previous_headings":"","what":"Surface Water","title":"Wasserportal","text":"","code":"stations <- wasserportal::get_stations() #> Importing 9 station overviews from Wasserportal Berlin ... ok. (8.61s) variables <- wasserportal::get_surfacewater_variables() variables <- variables[1:2]  # Downloads pre-compiled data (daily updated at 5am UTC)  # from https://kwb-r.github.io/wasserportal/daily_surface_water.<parameter_name>.csv # see also: https://kwb-r.github.io/wasserportal/articles/surface-water.html overview_names <- names(stations$overview_list)  wp_master <- wasserportal::wp_masters_data_to_list(overview_names) #> Rows: 75 Columns: 10 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr (7): Messstellenname, Gewaesser, Betreiber, Datum, Einheit, Klassifikati... #> dbl (2): Messstellennummer, Wasserstand #> lgl (1): Ganglinien #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 18 Columns: 10 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr (7): Messstellenname, Gewaesser, Betreiber, Datum, Einheit, Klassifikati... #> dbl (2): Messstellennummer, Durchfluss #> lgl (1): Ganglinie #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 64 Columns: 10 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr (9): Messstellennummer, Messstellenname, Gewaesser, Betreiber, Datum, Wa... #> lgl (1): Ganglinie #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 16 Columns: 10 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr (9): Messstellennummer, Messstellenname, Gewaesser, Betreiber, Datum, Le... #> lgl (1): Ganglinie #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 16 Columns: 9 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr (8): Messstellennummer, Messstellenname, Gewaesser, Betreiber, Datum, pH... #> lgl (1): Ganglinie #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 16 Columns: 10 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr (9): Messstellennummer, Messstellenname, Gewaesser, Betreiber, Datum, Sa... #> lgl (1): Ganglinie #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 16 Columns: 10 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr (9): Messstellennummer, Messstellenname, Gewaesser, Betreiber, Datum, Pa... #> lgl (1): Ganglinie #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 878 Columns: 11 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr (8): Bezirk, Auspraegung, Grundwasserleiter, Grundwasserspannung, Datum,... #> dbl (2): Messstellennummer, Grundwasserstand_m_ue_NHN #> lgl (1): Ganglinie #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 209 Columns: 10 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr (7): Bezirk, Auspraegung, Grundwasserleiter, Datum, Einheit, Klassifikat... #> dbl (2): Messstellennummer, Parameterwert #> lgl (1): Ganglinie #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. wp_data <- wasserportal::wp_timeseries_data_to_list(overview_names) #> Rows: 470681 Columns: 5 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr  (2): Parameter, Einheit #> dbl  (2): Messstellennummer, Tagesmittelwert #> date (1): Datum #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 110387 Columns: 5 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr  (2): Parameter, Einheit #> dbl  (2): Messstellennummer, Tagesmittelwert #> date (1): Datum #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 178270 Columns: 9 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr  (4): Zeitpunkt Minimum, Zeitpunkt Maximum, Parameter, Einheit #> dbl  (4): Messstellennummer, Tagesminimum, Tagesmittelwert, Tagesmaximum #> date (1): Datum #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 79099 Columns: 9 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr  (4): Zeitpunkt Minimum, Zeitpunkt Maximum, Parameter, Einheit #> dbl  (4): Messstellennummer, Tagesminimum, Tagesmittelwert, Tagesmaximum #> date (1): Datum #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 78850 Columns: 9 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr  (3): Zeitpunkt Minimum, Zeitpunkt Maximum, Parameter #> dbl  (4): Messstellennummer, Tagesminimum, Tagesmittelwert, Tagesmaximum #> lgl  (1): Einheit #> date (1): Datum #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 78105 Columns: 9 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr  (4): Zeitpunkt Minimum, Zeitpunkt Maximum, Parameter, Einheit #> dbl  (4): Messstellennummer, Tagesminimum, Tagesmittelwert, Tagesmaximum #> date (1): Datum #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 77923 Columns: 9 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr  (4): Zeitpunkt Minimum, Zeitpunkt Maximum, Parameter, Einheit #> dbl  (4): Messstellennummer, Tagesminimum, Tagesmittelwert, Tagesmaximum #> date (1): Datum #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 7285207 Columns: 5 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr  (2): Parameter, Einheit #> dbl  (2): Messstellennummer, Messwert #> date (1): Datum #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #> Rows: 713955 Columns: 5 #> ── Column specification ──────────────────────────────────────────────────────── #> Delimiter: \",\" #> chr  (2): Parameter, Einheit #> dbl  (2): Messstellennummer, Messwert #> date (1): Datum #>  #> ℹ Use `spec()` to retrieve the full column specification for this data. #> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.  ### Alternatively: download latest data from Wasserportal Berlin (takes a while) #wp_sw_data <- wasserportal::get_daily_surfacewater_data(stations, variables)  #wp_gw_data <- wasserportal::get_groundwater_data(stations) #wp_data <- c(wp_sw_data, wp_gw_data)"},{"path":"https://kwb-r.github.io/kwb.impetus/articles/wasserportal.html","id":"surface-water-level","dir":"Articles","previous_headings":"Surface Water","what":"Surface Water Level","title":"Wasserportal","text":"","code":"para_name <- \"surface-water_water-level\"  surfacewater_level_master <- wp_data[[get_data_name(para_name)]] %>%    dplyr::filter(.data$Parameter == \"Wasserstand\") %>%     set_date_year_decade_month() %>%   dplyr::left_join(get_master(wp_master[[get_master_name(para_name)]])) %>%    dplyr::mutate(     Tagesmittelwert_Pegelstand_mNN = as.numeric(.data$Pegelnullpunkt_m) +       .data$Tagesmittelwert / 100   ) %>%   ### remove -777 for messstellennummer 5867000 (few values in 2000) resulted by step above   dplyr::filter(.data$Tagesmittelwert_Pegelstand_mNN != -777) %>%   dplyr::select(- .data$Pegelnullpunkt_m) %>%    dplyr::mutate(Label = label_river_km(.data)) #> Importing 63 station metadata from Wasserportal Berlin ... ok. (34.08s) #> Joining, by = \"Messstellennummer\"  surfacewater_level_master_agg <- surfacewater_level_master %>%    group_by_site_decade_month_label() %>%    summarise_daily_mean_levels()  decades <- decades_tibble(surfacewater_level_master_agg$Dekade_Label)  kwb.utils::preparePdf(   \"surface-water_level.pdf\",   landscape = TRUE,   width.cm = 29.7,    height.cm = 21 ) #> [1] \"surface-water_level.pdf\"  ids <- unique(surfacewater_level_master_agg$Messstellennummer)  for (id in ids) {      p1 <- surfacewater_level_master_agg %>%      dplyr::filter(.data$Messstellennummer == id)       p2 <- surfacewater_level_master %>%      dplyr::filter(.data$Jahr == max(.data$Jahr)) %>%      group_by_site_year_month_label() %>%      summarise_daily_mean_levels() %>%      dplyr::filter(.data$Messstellennummer == id)       n_decades <- length(unique(p1$Dekade_Label))      gg <- p1 %>%      ggplot2::ggplot(mapping = ggplot2::aes(       x = as.integer(.data$Monat),        y = .data$Monatsmittelwert_Pegelstand_mNN,       col = as.factor(.data$Dekade_Label))     ) +      #ggplot2::geom_point(alpha = 0.5) +      decade_ribbons() +      kwb.impetus::scale_fill_decades(decades) +     kwb.impetus::scale_color_decades(decades) +     ggplot2::geom_point() +     ggplot2::geom_point(ggplot2::aes(       x = as.integer(.data$Monat),       y = .data$Monatsmittelwert_Pegelstand_mNN),        data = p2,       col = \"darkgrey\",       alpha = 0.5,        inherit.aes = FALSE,       show.legend = FALSE     ) +     ggplot2::scale_x_continuous(breaks = 1:12, labels = 1:12, minor_breaks = NULL) +     #ggplot2::geom_boxplot() +     ggplot2::facet_wrap(       ~ .data$Dekade_Label,       nrow = 1,        ncol = n_decades     ) +     ggplot2::theme_bw() +      ggplot2::theme(legend.position=\"bottom\") +     ggplot2::labs(       y = \"Monatsmittel Pegelstand (m NN)\",        x = \"Monatsnummer\",        col = \"Mittelwert\",        fill = \"5%/95% Konf.-intervall\",       title = unique(p1$Label)     )      plot(gg) }  dev.off() #> agg_png  #>       2"},{"path":"https://kwb-r.github.io/kwb.impetus/articles/wasserportal.html","id":"surface-water-flow","dir":"Articles","previous_headings":"Surface Water","what":"Surface Water Flow","title":"Wasserportal","text":"","code":"para_name <- \"surface-water_flow\"  surfacewater_flow_master <- wp_data[[get_data_name(para_name)]] %>%    dplyr::filter(.data$Parameter == \"Durchfluss\") %>%       dplyr::mutate(     Datum = as.Date(.data$Datum),     Jahr = as.integer(format(.data$Datum, \"%Y\")),      Dekade = kwb.impetus::floor_decade(.data$Jahr),     Dekade_Label = decade_label(.data$Dekade),     Monat = as.factor(format(.data$Datum, \"%m\"))   ) %>%    dplyr::left_join(get_master(wp_master[[get_master_name(para_name)]])) %>%    dplyr::mutate(Label = label_river_km(.data)) #> Importing 16 station metadata from Wasserportal Berlin ... ok. (9.76s) #> Joining, by = \"Messstellennummer\"  surfacewater_flow_master_agg <- surfacewater_flow_master %>%     group_by_site_decade_month_label() %>%    summarise_daily_mean_values()  decades <- decades_tibble(surfacewater_flow_master_agg$Dekade_Label)  kwb.utils::preparePdf(   \"surface-water_flow.pdf\",   landscape = TRUE,   width.cm = 29.7,    height.cm = 21 ) #> [1] \"surface-water_flow.pdf\"  ids <- unique(surfacewater_flow_master_agg$Messstellennummer)  for (id in ids) {      p1 <- surfacewater_flow_master_agg %>%      dplyr::filter(.data$Messstellennummer == id)       p2 <- surfacewater_flow_master %>%      dplyr::filter(.data$Jahr == max(.data$Jahr)) %>%      group_by_site_year_month_label() %>%      summarise_daily_mean_values() %>%      dplyr::filter(.data$Messstellennummer == id)       n_decades <- length(unique(p1$Dekade_Label))      gg <- p1 %>%      ggplot2::ggplot(mapping = ggplot2::aes(       x = as.integer(.data$Monat),        y = .data$Monatsmittelwert,       col = as.factor(.data$Dekade_Label))     ) +      #ggplot2::geom_point(alpha = 0.5) +      decade_ribbons() +      kwb.impetus::scale_fill_decades(decades) +     kwb.impetus::scale_color_decades(decades) +     ggplot2::geom_point() +     ggplot2::geom_point(ggplot2::aes(       x = as.integer(.data$Monat),       y = .data$Monatsmittelwert),        data = p2,       col = \"darkgrey\",       alpha = 0.5,        inherit.aes = FALSE,       show.legend = FALSE     ) +     ggplot2::scale_x_continuous(       breaks = 1:12,        labels = 1:12,        minor_breaks = NULL     ) +     #ggplot2::geom_boxplot() +     ggplot2::facet_wrap(~ .data$Dekade_Label, nrow = 1L, ncol = n_decades) +     ggplot2::theme_bw() +      ggplot2::theme(legend.position=\"bottom\") +     ggplot2::labs(       y = \"Monatsmittel Durchfluss (m\\u00B3/s)\",        x = \"Monatsnummer\",        col = \"Mittelwert\",        fill = \"5%/95% Konf.-intervall\",       title = unique(p1$Label)     )      plot(gg) }  dev.off() #> agg_png  #>       2"},{"path":[]},{"path":"https://kwb-r.github.io/kwb.impetus/articles/wasserportal.html","id":"grundwater-level","dir":"Articles","previous_headings":"Groundwater","what":"Grundwater Level","title":"Wasserportal","text":"","code":"para_name <- \"groundwater_level\"  groundwater_level_master <- wp_data[[get_data_name(para_name)]] %>%    dplyr::filter(.data$Parameter == \"GW-Stand\") %>%       set_date_year_decade_month() %>%    dplyr::left_join(get_master(wp_master[[get_master_name(para_name)]])) %>%    dplyr::mutate(Label = sprintf(     \"%s (%s, %s, gok: %.1f m, fok-fuk: %.1f-%.1f m)\",      .data$Messstellennummer,     .data$Bezirk,      .data$Grundwasserleiter,      as.double(.data$Gelaendeoberkante_GOK_m_ue_NHN),     as.double(.data$Filteroberkante_m_u_GOK),      as.double(.data$Filterunterkante_m_u_GOK)   )) #> Importing 878 station metadata from Wasserportal Berlin ... ok. (6.81s) #> Joining, by = \"Messstellennummer\"  groundwater_level_master_agg <- groundwater_level_master %>%   group_by_site_decade_month_label() %>%    summarise_measurements()  decades <- decades_tibble(groundwater_level_master_agg$Dekade_Label)  kwb.utils::preparePdf(   \"groundwater_level.pdf\",   landscape = TRUE,   width.cm = 29.7,    height.cm = 21 ) #> [1] \"groundwater_level.pdf\"  ids <- unique(groundwater_level_master_agg$Messstellennummer)  for (id in ids) {      p1 <- groundwater_level_master_agg %>%      dplyr::filter(.data$Messstellennummer == id)       p2 <- groundwater_level_master %>%      dplyr::filter(.data$Jahr == max(.data$Jahr)) %>%      group_by_site_year_month_label() %>%      summarise_measurements() %>%      dplyr::filter(.data$Messstellennummer == id)       n_decades <- length(unique(p1$Dekade_Label))      gg <- p1 %>%      ggplot2::ggplot(mapping = ggplot2::aes(       x = as.integer(.data$Monat),        y = .data$Monatsmittelwert,       col = as.factor(.data$Dekade_Label)     )) +      #ggplot2::geom_point(alpha = 0.5) +      decade_ribbons() +      kwb.impetus::scale_fill_decades(decades) +     kwb.impetus::scale_color_decades(decades) +     ggplot2::geom_point() +     ggplot2::geom_point(ggplot2::aes(       x = as.integer(.data$Monat),       y = .data$Monatsmittelwert),        data = p2,       col = \"darkgrey\",       alpha = 0.5,        inherit.aes = FALSE,       show.legend = FALSE     ) +     ggplot2::scale_x_continuous(       breaks = 1:12,        labels = 1:12,        minor_breaks = NULL     ) +     #ggplot2::geom_boxplot() +     ggplot2::facet_wrap(        ~ .data$Dekade_Label,       nrow = 1,        ncol = n_decades     ) +     ggplot2::theme_bw() +      ggplot2::theme(legend.position=\"bottom\") +     ggplot2::labs(       y = \"Monatsmittel Grundwasserstand (m NN)\",        x = \"Monatsnummer\",        col = \"Mittelwert\",        fill = \"5%/95% Konf.-intervall\",       title = unique(p1$Label)     )      plot(gg) }  dev.off() #> agg_png  #>       2"},{"path":"https://kwb-r.github.io/kwb.impetus/articles/wasserportal.html","id":"download","dir":"Articles","previous_headings":"","what":"Download","title":"Wasserportal","text":"plots created code exported pdf files, available download : Surface Water surface-water_level.pdf surface-water_flow.pdf Groundwater groundwater_level.pdf","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Michael Rustler. Author, maintainer. . Funder. . Copyright holder.","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Rustler M (2022). kwb.impetus: R Package Functions Used Project IMPETUS. R package version 0.0.0.9000, https://github.com/KWB-R/kwb.impetus.","code":"@Manual{,   title = {kwb.impetus: R Package with Functions Used in Project IMPETUS},   author = {Michael Rustler},   year = {2022},   note = {R package version 0.0.0.9000},   url = {https://github.com/KWB-R/kwb.impetus}, }"},{"path":"https://kwb-r.github.io/kwb.impetus/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"R Package with Functions Used in Project IMPETUS","text":"installing latest release R package run following code :","code":"# Enable repository from kwb-r options(repos = c(   kwbr = 'https://kwb-r.r-universe.dev',   CRAN = 'https://cloud.r-project.org'))    # Download and install 'kwb.impetus in R install.packages('kwb.impetus')  # Browse the 'kwb.impetus manual pages help(package = 'kwb.impetus')"},{"path":"https://kwb-r.github.io/kwb.impetus/index.html","id":"usage","dir":"","previous_headings":"","what":"Usage","title":"R Package with Functions Used in Project IMPETUS","text":"Checkout Data Analysis workflows Berlin case study site: Deutscher Wetterdienst (DWD) using monthly open-data precitiptation (1881-01 - 2022-08) potential evaporation (1991-01 - 2022-08). details dataset pre-processed, see : dwd_berlin_monthly Wasserportal surface water level/flow groundwater level Berlin (https://wasserportal.berlin.de).","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/reference/dwd_berlin_monthly.html","id":null,"dir":"Reference","previous_headings":"","what":"DWD Dataset (Precipitation and Potential Evaporation) Averaged for Berlin — dwd_berlin_monthly","title":"DWD Dataset (Precipitation and Potential Evaporation) Averaged for Berlin — dwd_berlin_monthly","text":"dataset containing precipitation potential diamonds.","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/reference/dwd_berlin_monthly.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"DWD Dataset (Precipitation and Potential Evaporation) Averaged for Berlin — dwd_berlin_monthly","text":"","code":"dwd_berlin_monthly"},{"path":"https://kwb-r.github.io/kwb.impetus/reference/dwd_berlin_monthly.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"DWD Dataset (Precipitation and Potential Evaporation) Averaged for Berlin — dwd_berlin_monthly","text":"data frame 53940 rows 10 variables: file name raw data file year year month month mean spatial mean value month sd spatial standard deviation value month min spatial minimum value month max spatial maximum value month n_values number 1x1km2 grids used spatial statistics calculation parameter parameter name url full url raw data file","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/reference/dwd_berlin_monthly.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"DWD Dataset (Precipitation and Potential Evaporation) Averaged for Berlin — dwd_berlin_monthly","text":"","code":"if (FALSE) { ############################################################################ #### R code used for creation of \"dwd_berlin_monthly.rds\" ############################################################################  remotes::install_github(\"kwb-r/kwb.dwd@dev\")  library(kwb.impetus)  yearmonth_start <- \"188101\" yearmonth_end <- paste0(format(Sys.Date(), \"%Y\"),                         sprintf(\"%02d\",                          as.numeric(format(Sys.Date(), \"%m\"))-1))                          system.time(dwd_berlin_precipitation <- kwb.dwd::load_precipitation_berlin( from = yearmonth_start, to = yearmonth_end) )  system.time(dwd_berlin_potentialevaporation <- kwb.dwd::load_potential_evaporation_berlin( from = yearmonth_start, to = yearmonth_end) )  dwd_berlin_monthly <- dwd_berlin_precipitation %>%   dplyr::mutate(parameter = \"precipitation\",  url = sprintf(\"%s/grids_germany/monthly/%s/%s\",  kwb.dwd:::dwd_url_climate_dir(), \"precipitation\", .data$file)) %>% dplyr::bind_rows( dwd_berlin_potentialevaporation %>% dplyr::mutate(parameter =\"potential evaporation\", url = sprintf(\"%s/grids_germany/monthly/%s/%s\", kwb.dwd:::dwd_url_climate_dir(), \"evapo_p\", .data$file)))  usethis::use_data(dwd_berlin_monthly, overwrite = TRUE) }"},{"path":"https://kwb-r.github.io/kwb.impetus/reference/floor_decade.html","id":null,"dir":"Reference","previous_headings":"","what":"floor to decade — floor_decade","title":"floor to decade — floor_decade","text":"floors previous decade.","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/reference/floor_decade.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"floor to decade — floor_decade","text":"","code":"floor_decade(value)"},{"path":"https://kwb-r.github.io/kwb.impetus/reference/floor_decade.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"floor to decade — floor_decade","text":"value year","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/reference/floor_decade.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"floor to decade — floor_decade","text":"decade","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/reference/floor_decade.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"floor to decade — floor_decade","text":"","code":"floor_decade(2000:2020) #>  [1] 2000 2000 2000 2000 2000 2000 2000 2000 2000 2000 2010 2010 2010 2010 2010 #> [16] 2010 2010 2010 2010 2010 2020"},{"path":"https://kwb-r.github.io/kwb.impetus/reference/pipe.html","id":null,"dir":"Reference","previous_headings":"","what":"Pipe operator — %>%","title":"Pipe operator — %>%","text":"See magrittr::%>% details.","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/reference/pipe.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Pipe operator — %>%","text":"","code":"lhs %>% rhs"},{"path":"https://kwb-r.github.io/kwb.impetus/reference/pipe.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Pipe operator — %>%","text":"lhs value magrittr placeholder. rhs function call using magrittr semantics.","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/reference/pipe.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Pipe operator — %>%","text":"result calling rhs(lhs).","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/reference/round_to_decade.html","id":null,"dir":"Reference","previous_headings":"","what":"round to decade — round_to_decade","title":"round to decade — round_to_decade","text":"rounds next decade end year >=5 floors previous decade end year <5.","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/reference/round_to_decade.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"round to decade — round_to_decade","text":"","code":"round_to_decade(values)"},{"path":"https://kwb-r.github.io/kwb.impetus/reference/round_to_decade.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"round to decade — round_to_decade","text":"values year","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/reference/round_to_decade.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"round to decade — round_to_decade","text":"decade","code":""},{"path":"https://kwb-r.github.io/kwb.impetus/reference/round_to_decade.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"round to decade — round_to_decade","text":"","code":"round_to_decade(2000:2020) #>  [1] 2000 2000 2000 2000 2000 2010 2010 2010 2010 2010 2010 2010 2010 2010 2010 #> [16] 2020 2020 2020 2020 2020 2020"},{"path":"https://kwb-r.github.io/kwb.impetus/news/index.html","id":"kwbimpetus-0009000","dir":"Changelog","previous_headings":"","what":"kwb.impetus 0.0.0.9000","title":"kwb.impetus 0.0.0.9000","text":"Added NEWS.md file track changes package. see https://style.tidyverse.org/news.html writing good NEWS.md","code":""}]
